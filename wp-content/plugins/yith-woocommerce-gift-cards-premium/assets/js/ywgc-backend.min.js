jQuery(function(h){function d(t,e){return parseFloat(h(e).data("amount").toString().replace(",","."))<parseFloat(h(t).data("amount").toString().replace(",","."))?1:-1}h(document).on("click","a.remove-amount",function(t){t.preventDefault();var t=h(this),e=(t=t.closest("span.variation-amount")).index(),o=h(".yith-wcmcs-currencies-prices"),a=t.parent().parent().parent().parent().hasClass("yith-wcmcs-currencies-prices--row");t.remove(),o.length&&!a&&h(".yith-wcmcs-currencies-prices--row .variation-amount-list").each(function(){h(this).children().eq(e).remove()}),h(document.body).trigger("removed_gift_card_amount")}),h(document).on("click","a.add-new-amount",function(t){t.preventDefault();var e,n=(t=h(this)).parent().find("#gift_card-amount").val(),o=t.closest("span.add-new-amount-section"),t=t.parent().parent().find("span.variation-amount-list"),a=h(".yith-wcmcs-currencies-prices"),o=o.parent().parent().hasClass("yith-wcmcs-currencies-prices--row"),i=h(".variation-amount-aux"),r=t.find("span.variation-amount").length,c=!0;(!n.length||parseFloat(n.replace(",","."))<=0)&&(c=!1,h(".add-new-amount-section #gift_card-amount").addClass("ywgc-wrong-amount-alert-border ywgc-wrong-amount-alert"),h(".add-new-amount-section .ywgc-currency-symbol-enter-amount").addClass("ywgc-wrong-amount-alert"),h(".ywgc-tooltip-container.ywgc-invalid-amount").removeClass("ywgc-hidden")),t.find("span.variation-amount .yith_wcgc_multi_currency").each(function(){parseFloat(h(this).val().replace(",","."))==parseFloat(n.replace(",","."))&&(c=!1,h(".add-new-amount-section #gift_card-amount").addClass("ywgc-wrong-amount-alert-border ywgc-wrong-amount-alert"),h(".add-new-amount-section .ywgc-currency-symbol-enter-amount").addClass("ywgc-wrong-amount-alert"),h(".ywgc-tooltip-container.ywgc-amount-already-added").removeClass("ywgc-hidden"))}),c&&(i.clone().insertBefore(i).removeClass("ywgc-hidden variation-amount-aux").addClass("variation-amount new-amount"),i=h(".variation-amount.new-amount input.yith_wcgc_multi_currency"),e=h(".variation-amount.new-amount input.gift_card-amount"),i.attr("name","gift-card-amounts["+r+"]"),i.val(n),i.parent().data("amount",n),e.val(n),e.data("amount",n),h(".variation-amount.new-amount").data("amount",n),h(".variation-amount.new-amount").removeClass("new-amount"),t.find("span.variation-amount ").sort(d).appendTo(t),h("#gift_card-amount").val(""),h("#gift_card-amount").selectionStart=0,h("#gift_card-amount").selectionEnd=0,a.length&&!o&&h(".yith-wcmcs-currencies-prices--row .variation-amount-list").each(function(){var t=h(this).find(".variation-amount-aux-currency"),t=(t.clone().insertBefore(t).removeClass("ywgc-hidden variation-amount-aux-currency").addClass("variation-amount new-amount-currency"),h(".variation-amount.new-amount-currency input.yith_wcgc_multi_currency")),e=h(".variation-amount.new-amount-currency input.gift_card-amount"),o=e.data("currency-id"),a=h(this).parent().parent().parent().data("currency-options"),a=function(t,e,o,a,n,i){var r=parseFloat(t)/parseFloat(e)*parseFloat(o);switch(n){case"round-up":var c=Math.pow(10,a);r=-Math.round(-1*r*c-.5)/c;break;case"round-down":r-=.5/Math.pow(10,a);break;case"round-int-up":r=Math.ceil(r);break;case"round-int-down":r=Math.floor(r)}return r=r.toFixed(a),(r=Math.max(parseFloat(r.replace(i,".")),0).toString().replace(".",i))<0?0:r}(parseFloat(n.replace(",",".")),1,a.rate,a.decimals,a.round,a.decimal_separator);t.attr("name","yith_wcgc_multi_currency[gift-card-amounts]["+o+"]["+r+"]"),t.val(a),t.parent().data("amount",a),e.val(a),e.data("amount",a),h(".variation-amount.new-amount-currency").data("amount",a).removeClass("new-amount-currency"),h(this).find("span.variation-amount").sort(d).appendTo(h(this))}),h(document.body).trigger("added_gift_card_amount"))}),h(document).on("input",".add-new-amount-section #gift_card-amount",function(){h(this).removeClass("ywgc-wrong-amount-alert-border ywgc-wrong-amount-alert"),h(".add-new-amount-section .ywgc-currency-symbol-enter-amount").removeClass("ywgc-wrong-amount-alert"),h(".ywgc-tooltip-container").addClass("ywgc-hidden")}),h(document).on("keypress","input#gift_card-amount",function(t){13===event.which&&(t.preventDefault(),h(this).parent().find("a.add-new-amount").click())}),h(document).on("focusout","input.gift_card-amount",function(t){t.preventDefault();t=h(this).parent().find(".gift_card-amount").val();h(this).parent().find(".yith_wcgc_multi_currency").val(t)}),h(document).on("change",'input[name="ywgc_physical_gift_card"]',function(t){var e=h(this).prop("checked");h('input[name="_virtual"]').prop("checked",!e)}),h("body .ywgc_order_sold_as_gift_card").each(function(){h(this).parent("td").find(".wc-order-item-name").hide()}),h("._manage_stock_field").addClass("show_if_gift-card").show(),"undefined"!=typeof jQuery.fn.datepicker&&h(".ywgc-expiration-date-picker").datepicker({dateFormat:ywgc_data.date_format,minDate:1});var a=h("button.ywgc-actions:first").text();h(document).on("click","button.ywgc-actions",function(t){t.preventDefault();var e=h(this),t=e.prev("#ywgc_direct_link").text(),o=h("#ywgc_copied_to_clipboard").text();navigator.clipboard&&window.isSecureContext&&navigator.clipboard.writeText(t).then(()=>{e.text(o)},()=>{console.log("Copy to clipboard failed")}),setTimeout(function(){e.text(a)},1e3)}),h(document).on("change",".ywgc-toggle-enabled input",function(){var t="yes"===h(this).val()?"yes":"no",e=h(this).closest(".ywgc-toggle-enabled").data("gift-card-id");h.ajax({type:"POST",data:{action:"ywgc_toggle_enabled_action",id:e,enabled:t},url:ajaxurl,success:function(t){"undefined"!=typeof t.error&&alert(t.error)}})}),"yes"===h(".ywgc-override-product-settings input").val()&&(h(".ywgc-custom-amount-field").removeClass("ywgc-hidden"),h(".minimal-amount-field").removeClass("ywgc-hidden"),h(".maximum-amount-field").removeClass("ywgc-hidden")),h(document).on("change",".ywgc-override-product-settings > input",function(){"yes"==("yes"===h(this).val()?"yes":"no")?(h(".ywgc-custom-amount-field").show(),"yes"===h(".ywgc-custom-amount-field input").val()&&(h(".minimal-amount-field").show(),h(".maximum-amount-field").show())):(h(".ywgc-custom-amount-field").hide(),"yes"===h(".ywgc-custom-amount-field input").val()&&(h(".minimal-amount-field").hide(),h(".maximum-amount-field").hide()))}),"yes"===h(".ywgc-custom-amount-field input").val()&&"yes"==h(".ywgc-override-product-settings input").val()?(h(".minimal-amount-field").removeClass("ywgc-hidden"),h(".maximum-amount-field").removeClass("ywgc-hidden")):(h(".minimal-amount-field").addClass("ywgc-hidden"),h(".maximum-amount-field").addClass("ywgc-hidden")),h(document).on("change",".ywgc-custom-amount-field input",function(){"yes"==("yes"===h(this).val()?"yes":"no")?(h(".minimal-amount-field").show(),h(".maximum-amount-field").show()):(h(".minimal-amount-field").hide(),h(".maximum-amount-field").hide())}),"yes"===h(".ywgc-add-discount-settings input").val()&&h(".ywgc-add-discount-settings-container").removeClass("ywgc-hidden"),h(document).on("change",".ywgc-add-discount-settings input",function(){"yes"==("yes"===h(this).val()?"yes":"no")?h(".ywgc-add-discount-settings-container").show():h(".ywgc-add-discount-settings-container").hide()}),"yes"===h(".ywgc-expiration-settings input").val()&&h(".ywgc-expiration-settings-container").removeClass("ywgc-hidden"),h(document).on("change",".ywgc-expiration-settings input",function(){"yes"==("yes"===h(this).val()?"yes":"no")?h(".ywgc-expiration-settings-container").show():h(".ywgc-expiration-settings-container").hide()}),h(".ywgc-excluded-categories-settings input").val()&&h(".ywgc-excluded-categories-settings-container").removeClass("ywgc-hidden"),h(document).on("change",".ywgc-excluded-categories-settings input",function(){"yes"==("yes"===h(this).val()?"yes":"no")?h(".ywgc-excluded-categories-settings-container").show():h(".ywgc-excluded-categories-settings-container").hide()}),h(document).ready(function(){h(".ywgc-product-edit-page-amount-options .variation-amount-list").has("span.variation-amount").length||h(".ywgc-product-edit-page-multi-currency-options").hide()}),h(document).on("added_gift_card_amount",function(t){h(".ywgc-product-edit-page-multi-currency-options").show();var e=h(".ywgc-product-edit-page-amount-options .variation-amount-list span.variation-amount").length;h(".ywgc-product-edit-page-multi-currency-options .yith-wcmcs-currencies-prices .yith-wcmcs-currencies-prices--row").each(function(){var t=h(this).find(".variation-amount-list span.variation-amount").length;e!=t&&(t=Math.abs(e-t),h(this).find(".variation-amount-list span.variation-amount:nth-last-child(-n+"+t+")").remove())})}),h(document).on("removed_gift_card_amount",function(t){h(".ywgc-product-edit-page-amount-options .variation-amount-list").has("span").length||h(".ywgc-product-edit-page-multi-currency-options").hide();var e=h(".ywgc-product-edit-page-amount-options .variation-amount-list span.variation-amount").length;h(".ywgc-product-edit-page-multi-currency-options .yith-wcmcs-currencies-prices .yith-wcmcs-currencies-prices--row").each(function(){var t=h(this).find(".variation-amount-list span.variation-amount").length;e!=t&&(t=Math.abs(e-t)+1,h(this).find(".variation-amount-list span.variation-amount:nth-last-child(-n+"+t+")").remove())})}),h(document).on("click",".create-code-custom-button",function(t){t.preventDefault(),yith.ui.modal({title:ywgc_data.code_modal.title,content:ywgc_data.code_modal.content,footer:ywgc_data.code_modal.footer,width:600,allowWpMenu:!1,closeWhenClickingOnOverlay:!0,allowClosingWithEsc:!0,classes:{title:"yith-gift-card-generator-modal-title",content:"yith-gift-card-generator-modal-content",footer:"yith-gift-card-generator-modal-footer"}})}),h("#gift-card-generator-radio-modal-generator").parent().append("#ywgc-gift-card-generator-container"),h(document).on("click","#gift-card-generator-radio-modal-one_code",function(){h("#yith-gift-card-generator-modal-button").attr("href",ywgc_data.create_code_url).removeClass("multiple-generation"),h("#ywgc-gift-card-generator-container").css("display","none")}),h(document).on("click","#gift-card-generator-radio-modal-generator",function(){var t=h("input#gift-card-generator-radio-modal-generator").parent(),e=h("#ywgc-gift-card-generator-container");t.append(e),h("#ywgc-gift-card-generator-container").css("display","inline-flex"),h("#yith-gift-card-generator-modal-button").attr("href","").addClass("multiple-generation")}),h(document).on("click",".export-import-custom-button",function(t){t.preventDefault(),yith.ui.modal({title:ywgc_data.export_import_modal.title,content:ywgc_data.export_import_modal.content,width:600,allowWpMenu:!1,closeWhenClickingOnOverlay:!0,allowClosingWithEsc:!0,classes:{title:"yith-gift-card-export-import-modal-title",content:"yith-gift-card-export-import-modal-content",footer:"yith-gift-card-export-import-modal-footer"},onCreate:function(){h("#ywgc_export_option_date_from").datepicker({dateFormat:ywgc_data.date_format}),h("#ywgc_export_option_date_to").datepicker({dateFormat:ywgc_data.date_format})}})});const v=function(t){h(".single-step.active").removeClass("active").hide(),h('.single-step[data-step="'+t+'"]').show().addClass("active"),h(".step-label.active").removeClass("active"),h('.step-label[data-step="'+t+'"]').addClass("active")},e=(h(document).on("click",".move-step.yith-gift-card-export-import-modal-button",function(t){t.preventDefault(),e(h("#gift-card-export-import-radio-modal").val()),v(h(this).data("step-to"))}),h(document).on("click",".previous",function(t){t.preventDefault(),v(h(this).data("step-to"))}),h(document).on("click","button.try-again",function(t){t.preventDefault(),v(h(this).data("step-to"))}),function(t){"import"===t?(h(".yith-gift-card-export-import-modal-title.choose-action").hide(),h(".yith-gift-card-export-import-modal-title.export").hide(),h(".yith-gift-card-export-import-modal-title.import").show(),h(".export-configuration").hide(),h(".ywgc-export-button").hide(),h(".ywgc-export-done").hide(),h(".import-configuration").show(),h(".ywgc-import-button").show(),h(".ywgc-import-done").show(),h("input#ywgc_file_import_csv").prop("required",!0)):(h(".yith-gift-card-export-import-modal-title.choose-action").hide(),h(".yith-gift-card-export-import-modal-title.import").hide(),h(".yith-gift-card-export-import-modal-title.export").show(),h(".export-configuration").show(),h(".ywgc-export-button").show(),h(".ywgc-export-done").show(),h(".import-configuration").hide(),h(".ywgc-import-button").hide(),h(".ywgc-import-done").hide(),h("input#ywgc_file_import_csv").prop("required",!1))});h(document).on("change","#ywgc_export_option_date",function(t){t.preventDefault(),"by_date"===h(this).val()?h("div.ywgc-date-from-to-date-selectors").show():(h("div.ywgc-date-from-to-date-selectors").hide(),h("input#ywgc_export_option_date_from").datepicker("setDate",null),h("input#ywgc_export_option_date_to").datepicker("setDate",null))}),h(document).on("submit","#yith-ywgc-export-import-form",function(t){t.preventDefault();var t=new FormData(document.getElementById("yith-ywgc-export-import-form")),e=t.get("gift-card-export-import-radio-modal"),o=t.get("ywgc_export_option_date"),a=t.get("ywgc_export_option_date_from"),n=t.get("ywgc_export_option_date_to"),i=t.get("ywgc_export_option_order_id"),r=t.get("ywgc_export_option_gift_card_code"),c=t.get("ywgc_export_option_gift_card_code"),d=t.get("ywgc_export_option_gift_card_amount"),s=t.get("ywgc_export_option_gift_card_balance"),u=t.get("ywgc_export_option_sender_name"),l=t.get("ywgc_export_option_recipient_name"),m=t.get("ywgc_export_option_recipient_email"),g=t.get("ywgc_export_option_message"),p=t.get("ywgc_export_option_expiration_date"),y=t.get("ywgc_export_option_delivery_date"),f=t.get("ywgc_export_option_internal_note"),w=t.get("ywgc_csv_delimiter"),_=t.get("ywgc_file_import_csv");t.get("_wpnonce");formDataToSend=new FormData,"export"===e?(formDataToSend.set("action","yith_ywgc_run_exporter"),formDataToSend.set("date_option",o),formDataToSend.set("from",a),formDataToSend.set("to",n),formDataToSend.set("order_id",i),formDataToSend.set("gift_card_id",r),formDataToSend.set("gift_card_code",c),formDataToSend.set("gift_card_amount",d),formDataToSend.set("gift_card_balance",s),formDataToSend.set("sender_name",u),formDataToSend.set("recipient_name",l),formDataToSend.set("recipient_email",m),formDataToSend.set("message",g),formDataToSend.set("expiration_date",p),formDataToSend.set("delivery_date",y),formDataToSend.set("internal_note",f),formDataToSend.set("csv_delimitier",w),formDataToSend.set("to",n),formDataToSend.set("nonce",ywgc_data.nonce),h.ajax({type:"POST",url:ajaxurl,data:formDataToSend,processData:!1,contentType:!1,cache:!1,success:function(t){var e=document.createElement("a"),t=new Blob(["\ufeff"+t],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(t),o=new Date,o=o.getDate()+"-"+(o.getMonth()+1)+"-"+o.getFullYear()+"-"+o.getHours()+"-"+o.getMinutes()+"-"+o.getSeconds();e.href=t,e.download="gift-card-export_"+o+".csv",document.body.appendChild(e),e.click(),document.body.removeChild(e),h("#step-configuration").hide(),h("#ywgc-gift-card-export-import-container").addClass("completed"),h("#step-completed button.try-again").hide()},error:function(t){h("#step-completed button.yith-plugin-fw__button--close").hide(),console.log("ERROR"),console.log(t)}})):(formDataToSend.set("action","yith_ywgc_run_importer"),formDataToSend.set("file_url",_),formDataToSend.set("csv_delimitier",w),formDataToSend.set("nonce",ywgc_data.nonce),_&&h.ajax({type:"POST",url:ajaxurl,data:formDataToSend,processData:!1,contentType:!1,cache:!1,success:function(t){h("#step-configuration").hide(),1===t.code||2===t.code?(h(".ywgc-import-done").text(t.value),h("#step-completed img").attr("src",t.image),h("#ywgc-gift-card-export-import-container").addClass("completed"),t.success&&h("#step-completed button.try-again").hide()):(h("#ywgc-gift-card-export-import-container").addClass("completed"),h("#step-completed button.try-again").hide())},error:function(t){console.log("ERROR"),console.log(t)},complete:function(t){h("#posts-filter").load(document.URL+" #posts-filter")}})),v(4)});h(document).on("click","#close-modal",function(){h(".yith-plugin-fw__modal__close").trigger("click"),location.reload()}),h(document).on("click","#yith-gift-card-generator-modal-button.multiple-generation",function(t){t.preventDefault();var e,t=h("#ywgc-gift-card-generator-quantity").val(),o=h("#ywgc-gift-card-generator-amount").val();0==t||t<0?h("#ywgc-gift-card-generator-quantity").css("border-color","red"):0==o?h("#ywgc-gift-card-generator-amount").css("border-color","red"):((e=h(this).parent().parent().parent()).block({message:null,overlayCSS:{background:"#f1f1f1",opacity:.7}}),t={quantity:t,amount:o,action:"ywgc_gift_card_generator",nonce:ywgc_data.generate_gift_cards_nonce},h.ajax({type:"POST",url:ywgc_data.ajax_url,data:t,dataType:"html",success:function(t){setTimeout(function(){e.unblock(),h(".yith-plugin-fw__modal__close").click()},1500)},error:function(t){e.unblock(),console.log("ERROR"),console.log(t)},complete:function(t){location.reload()}}))}),h(document).on("change","#ywgc-gift-card-generator-quantity",function(t){t.preventDefault();t=h(this).val();0==t||t<0?h(this).css("border-color","red"):h(this).css("border-color","#cbd5e1")}),h(document).on("change","#ywgc-gift-card-generator-amount",function(t){t.preventDefault();t=h(this).val();0==t||t<0?h(this).css("border-color","red"):h(this).css("border-color","#cbd5e1")}),h(document).on("click",".toggle-settings",function(t){t.preventDefault(),h(this).closest(".yith-ywgc-row").toggleClass("active");t=h(this).data("target");h("#"+t).slideToggle()}),h(document).on("click",".yith-ywgc-save-settings",function(t){t.preventDefault(),h(this).closest("form").find(".wp-switch-editor.switch-html").trigger("click");t=h(this.closest(".email-settings")).attr("id"),t={action:"yith_ywgc_save_email_settings",params:h(this).closest("form").serialize(),email_key:t,security:ywgc_data.save_email_settings_nonce};h.ajax({type:"POST",data:t,url:ajaxurl,success:function(t){var e=h(".yith-ywgc-row.active");e.find(".email-settings").slideToggle(),e.toggleClass("active")}})}),h(document).on("change","#yith-ywgc-email-status",function(){var t={action:"yith_ywgc_save_mail_status",enabled:h(this).val(),email_key:h(this).closest(".yith-plugin-fw-onoff-container ").data("email_key"),security:ywgc_data.save_email_status_nonce};h.ajax({type:"POST",data:t,url:ajaxurl,success:function(t){console.log("Email status updated")}})})});
(()=>{"use strict";function e(a){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(a)}var a;a=jQuery,window.llms_assignments=new function(){var s=a("#llms-assignment-id").val(),n=!1,t=a(".llms-assignment-content"),l=a(".llms-assignments-save-indicator"),i=a("#llms-assignment-submit");function o(){return t.find(".ql-editor")[0].innerHTML}function r(){return t.hasClass("type--tasklist")?"tasklist":t.hasClass("type--essay")?"essay":t.hasClass("type--upload")?"upload":""}function d(){var e=!0;"tasklist"===r()?a('.llms-assignment-task input[type="checkbox"]').each((function(){if(!a(this).is(":checked"))return e=!1,!1})):"essay"===r()?e=t.hasClass("llms-assignments-is-valid"):"upload"===r()&&(e=t.find(".llms-assignment-upload-file").length),e?i.removeAttr("disabled"):i.attr("disabled","disabled")}function m(e,s,n,t){var l=a("<div />").appendTo("body");l.iziModal({title:e,subtitle:s,icon:"fa fa-exclamation-triangle",headerColor:"#d43838",pauseOnHover:!0,timeout:4e3,timeoutProgressbar:!0}),l.iziModal("open")}function c(){n?(n=!1,LLMS.Spinner.stop(l)):(n=!0,LLMS.Spinner.start(l,"small"))}function u(e,a,s,n,t){m(LLMS.l10n.translate("Error updating task, please try again."),s),a?e.removeAttr("checked"):e.attr("checked","checked")}function f(n){if(function(e){var s=a("#llms-assignment-upload-file").attr("accept");if(s){var n=e.name.split(".").reverse()[0];if(-1===a.map(s.split(","),a.trim).indexOf(n))return m(LLMS.l10n.translate("Invalid filetype selected.")),!1}return!0}(n)){var t=LLMS.l10n.translate("Error Uploading File"),l=(a("#llms-assignment-uploader-zone"),a("#llms-assignment-upload-file")),o=new FormData;o.append("action","llms_assignments_upload_file"),o.append("file",n),o.append("assignment_id",s),o.append("nonce",a("#llms-assignment-upload-nonce").val()),LLMS.Ajax.call({data:o,contentType:!1,processData:!1,beforeSend:function(){c(),i.attr("disabled","disabled")},error:function(a,s,n){var o;o="object"===e(n)&&n.message?n.message:n,m(t,o),l.replaceWith(l.val("").clone(!0)),c(),i.removeAttr("disabled")},success:function(e){e&&e.success?window.location.reload():(c(),i.removeAttr("disabled"),m(t,e.message),l.replaceWith(l.val("").clone(!0)))}})}}return d(),a('.llms-assignment-task input[type="checkbox"]').on("change",(function(){var n=a(this),t=n.is(":checked");LLMS.Ajax.call({data:{action:"llms_assignments_update_task",assignment_id:s,task_id:n.val(),status:t?1:0},beforeSend:function(){c()},error:function(a,s,l){var i;i="object"===e(l)&&l.message?l.message:l,u(n,t,i),c()},success:function(e){if(e||e.success){if(e.data){var a=n.next(".llms-task-main");t&&e.data.date_html?a.append(e.data.date_html):a.find(".llms-task-time").remove()}}else u(n,t,e.message);c(),d()}})})),i.on("click",(function(){var a=LLMS.l10n.translate("Error submitting assignment, please try again."),n="";"essay"===r()&&(n=o()),LLMS.Ajax.call({data:{action:"llms_assignments_submit_assignment",assignment_id:s,submission:n},beforeSend:function(){c(),i.attr("disabled","disabled")},error:function(s,n,t){var l;l="object"===e(t)&&t.message?t.message:t,c(),m(a,l),i.removeAttr("disabled")},success:function(e){e&&e.success?window.location.reload():(c(),m(a,e.message),i.removeAttr("disabled"))}})})),"essay"===r()?function(n){if("yes"!==n.attr("data-llms-setup")){var l=n.find(".llms-assignment-essay-field"),i=l.parent().hasClass("status--complete");console.log(i);var r,u,f=new Quill(l[0],{modules:{toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],["blockquote"],[{align:""},{align:"center"},{align:"right"},{align:"justify"}],[{direction:"rtl"}]],wordcount:{l10n:{singluar:LLMS.l10n.translate("word"),plural:LLMS.l10n.translate("words"),min:LLMS.l10n.translate("Minimum"),max:LLMS.l10n.translate("Maximum")},min:l.attr("data-words-min"),max:l.attr("data-words-max"),onChange:function(e,a,s){var n="llms-assignments-is-valid";a.min&&s<a.min||a.max&&s>a.max?t.removeClass(n):t.addClass(n),d()}}},readOnly:i,scrollingContainer:".llms-scrolling-container",theme:"snow"});n.attr("data-llms-setup","yes"),"rtl"===a("html").attr("dir")&&(f.format("direction","rtl"),f.format("align","right")),i||setInterval((function(){var a,n;(r=o())!==u&&(a=r,n=LLMS.l10n.translate("Error saving assignment, please try again."),LLMS.Ajax.call({data:{action:"llms_assignments_update_essay",assignment_id:s,content:a},beforeSend:function(){c()},error:function(a,s,t){var l;l="object"===e(t)&&t.message?t.message:t,m(n,l),c()},success:function(e){e||e.success||m(n,e.message),c()}})),u=r}),1e4)}}(t):"upload"===r()&&(a(window).on("dragover",(function(e){e.preventDefault()})),a(window).on("drop",(function(e){e.preventDefault(),a(e.target).closest(".llms-assignment-upload-field").length&&f(e.originalEvent.dataTransfer.files[0])})),a("#llms-assignment-uploader-zone").on("dragover",(function(){a(this).addClass("dragover")})),a("#llms-assignment-uploader-zone").on("dragleave dragend drop",(function(){a(this).removeClass("dragover")})),a("#llms-assignment-upload-file").on("change",(function(e){f(e.target.files[0])})),a("#llms-assignment-remove-file").on("click",(function(a){var n=LLMS.l10n.translate("Error Removing Upload");LLMS.Ajax.call({data:{action:"llms_assignments_upload_remove",assignment_id:s},beforeSend:function(){c(),i.attr("disabled","disabled")},error:function(a,s,t){var l;l="object"===e(t)&&t.message?t.message:t,c(),m(n,l),i.removeAttr("disabled")},success:function(e){e&&e.success?window.location.reload():(c(),m(n,e.message),i.removeAttr("disabled"))}})}))),a(".llms-donut").each((function(){LLMS.Donut(a(this))})),this}})();
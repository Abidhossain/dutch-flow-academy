(()=>{"use strict";var t,e,n,i,s,a;t=jQuery,e={model:function(t,e){return window.llms_builder.construct.get_model("AssignmentTask",t,e)},initialize:function(){this.on("reorder",this.update_order),this.on("add",this.update_order),this.on("remove",this.update_order)},update_order:function(){var t=window.llms_builder.assignments.get_task_markers();this.each((function(e){e.set("marker",t[this.indexOf(e)])}),this)}},n={relationships:{parents:{model:"lesson",type:"model"},children:{tasks:{class:"TasksCollection",model:"task",type:"collection"}}},schema:{default:{title:LLMS.l10n.translate("General Settings"),toggleable:!0,fields:[[{attribute:"permalink",id:"permalink",type:"permalink"}],[{attribute:"video_embed",id:"video-embed",label:LLMS.l10n.translate("Video Embed URL"),type:"video_embed"},{attribute:"audio_embed",id:"audio-embed",label:LLMS.l10n.translate("Audio Embed URL"),type:"audio_embed"}],[{attribute:"content",id:"llms-assignment-description",label:LLMS.l10n.translate("Description"),type:"switch-editor",switch_attribute:"has_description"}],[{attribute:"assignment_type",id:"assignment-type",label:LLMS.l10n.translate("Assignment Type"),type:"select",options:{tasklist:LLMS.l10n.translate("Task List"),essay:LLMS.l10n.translate("Essay"),upload:LLMS.l10n.translate("Upload")}},{attribute:"passing_percentage",condition:function(){return!this.is_tasklist()},id:"passing-percentage",label:LLMS.l10n.translate("Passing Percentage"),min:0,max:100,tip:LLMS.l10n.translate("Minimum grade required to pass the assignment."),type:"number"}],[{attribute:"points",id:"points",label:LLMS.l10n.translate("Assignment Weight"),label_after:LLMS.l10n.translate("POINTS"),min:0,max:99,tip:LLMS.l10n.translate("Determines the weight of the assignment when calculating the grade of the lesson."),type:"number",condition:function(){return this.get_parent()&&"yes"===this.get_parent().get("quiz_enabled")}}],[{attribute:"word_count_min",condition:function(){return"essay"===this.get("assignment_type")},id:"word-count-min",label:LLMS.l10n.translate("Minimum Word Count"),min:1,switch_attribute:"enable_word_count_min",type:"switch-number"},{attribute:"word_count_max",condition:function(){return"essay"===this.get("assignment_type")},id:"word-count-max",label:LLMS.l10n.translate("Maximum Word Count"),min:1,switch_attribute:"enable_word_count_max",type:"switch-number"},{attribute:"allowed_mimes",condition:function(){return"upload"===this.get("assignment_type")},id:"allowed-mimes",label:LLMS.l10n.translate("Restrict File Types"),multiple:!0,switch_attribute:"enable_allowed_mimes",type:"switch-select",options:function(){return window.llms_builder.assignments.get_allowed_mime_types()}}]]}},defaults:function(){return{id:_.uniqueId("temp_"),title:LLMS.l10n.translate("New Assignment"),type:"llms_assignment",content:"",allowed_mimes:[],assignment_type:"tasklist",enable_allowed_mimes:"no",enable_word_count_max:"no",enable_word_count_min:"no",has_description:"no",passing_percentage:65,points:1,word_count_max:"",word_count_min:""}},initialize:function(){this.init_custom_schema(),this.startTracking(),this.init_relationships()},add_task:function(t,e){return t=t||{},e=e||{},this.has_temp_id()||(t.assignment_id=this.get("id")),this.get("tasks").add(t,e)},is_tasklist:function(){return"tasklist"===this.get("assignment_type")},get_l10n_type:function(t){return t?LLMS.l10n.translate("assignments"):LLMS.l10n.translate("assignment")}},i={relationships:{parents:{model:"assignment",type:"model"}},defaults:function(){return{id:_.uniqueId("temp_"),title:"",type:"task",marker:"A"}},initialize:function(){this.startTracking(),this.init_relationships()},get_l10n_type:function(t){return t?LLMS.l10n.translate("tasks"):LLMS.l10n.translate("task")},get_trash_id:function(){return this.get("assignment_id")+":"+this.get("id")}},s={className:"llms-assignment-task",events:{},id:function(){return"llms-assignment-task-"+this.model.id},tagName:"li",template:wp.template("llms-assignment-task-template"),initialize:function(){this.render()},render:function(){return this.$el.html(this.template(this.model)),this.init_formatting_els(),this.$el.find("input[data-link]").attr("data-link","https://"),this}},a={emptyListCaption:LLMS.l10n.translate('Click "Add Task" to get started'),modelView:function(t,e){return new s(t,e)},processKeyEvents:!1,selectable:!1,sortable:!0,sortableOptions:{axis:!1,cursor:"move",handle:".llms-task-marker",items:".llms-assignment-task",placeholder:"llms-assignment-task llms-sortable-placeholder"},sortable_start:function(){this.$el.addClass("dragging")},sortable_stop:function(){this.$el.removeClass("dragging")}},window.wp.hooks.addFilter("llms_define_quiz_schema","llms/llms_assignments/modifyQuizSchema",(function(t){return t.default.fields.push([{attribute:"points",id:"points",label:LLMS.l10n.translate("Quiz Weight"),label_after:LLMS.l10n.translate("POINTS"),min:0,max:99,tip:LLMS.l10n.translate("Determines the weight of the quiz when calculating the grade of the lesson."),type:"number",condition:function(){return"yes"===this.get_parent().get("assignment_enabled")}}]),t})),window.wp.hooks.addAction("llms_quiz_model_init","llms/llms_assignments/maybe_set_quiz_defaults",(function(t){_.isNumber(t.get("points"))||t.set("points",1)})),window.llms_builder.assignments=new function(t){function l(){this.model.add_task()}this.init=function(){var t=window.llms_builder.assignments.get_allowed_mime_types();_.each(t,(function(e,n){t[n]=e+" ("+n+")"})),window.llms_builder.construct.register_collection("TasksCollection",e),window.llms_builder.construct.register_model("Assignment",n),window.llms_builder.construct.register_model("AssignmentTask",i),a=Backbone.CollectionView.extend(a),s=window.llms_builder.construct.extend_view(s,"Editable","Trashable"),Backbone.pubSub.on("task-maybe-restart-tracking",(function(t,e){t.set("assignment_id",e.assignment_id)}))},this.get_allowed_mime_types=function(){return t.mime_types},this.get_assignment=function(t,e){return window.llms_builder.construct.get_model("Assignment",t,e)},this.get_task_markers=function(){return t.markers},this.get_view_events=function(){return{"click #llms-add-assignment-task":l}},this.render_editor=function(t){t.model.is_tasklist()&&(t.TaskListView=new a({el:t.$el.find(".llms-assignment-tasks"),collection:t.model.get("tasks")}),t.TaskListView.render(),t.TaskListView.on("sortStart",t.TaskListView.sortable_start),t.TaskListView.on("sortStop",t.TaskListView.sortable_stop))}}(window.llms_builder.assignments),void 0===window.llms_builder.CourseModel?t(document).on("llms-builder-pre-init",window.llms_builder.assignments.init):window.llms_builder.assignments.init()})();
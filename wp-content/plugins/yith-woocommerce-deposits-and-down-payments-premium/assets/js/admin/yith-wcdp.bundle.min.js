(()=>{"use strict";var e={r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){e=function(e,t){if("object"!=r(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);if("object"!=r(e=i.call(e,t||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==r(e)?e:e+""}function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,o(n.key),n)}}function a(e,t,i){t&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1})}e.r(t);var l=jQuery,s=l(document),d=(l("body"),null==(e=yith_wcdp)?void 0:e.labels);function u(e,t,i){return(t=o(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var c=function(){function t(e){i(this,t),u(this,"$container",void 0),u(this,"$fields",void 0),u(this,"dependencies",{}),this.$container=e,null!=(e=this.$container)&&e.length&&this.init()}return a(t,[{key:"init",value:function(){var e;return this.initFields(),!(null==(e=this.$fields)||!e.length||(this.initDependencies(),0))}},{key:"reInit",value:function(){return this.$fields.off("change",this.applyDependencies),this.init()}},{key:"initFields",value:function y(){this.$fields=this.$container.find(":input")}},{key:"initDependencies",value:function h(){this.buildDependenciesTree(),Object.keys(this.dependencies).length&&this.handleDependencies()}},{key:"buildDependenciesTree",value:function(){var n=this;this.$fields.closest("[data-dependencies]").each(function(){var e=l(this),t=e.attr("id");t&&(t=u({},t,e.data("dependencies")),n.dependencies=l.extend(n.dependencies,t))}),this.$container.find("[data-dep-target]").each(function(){var e=l(this),t=e.data("dep-id"),i=e.data("dep-target"),e=e.data("dep-value");t&&i&&e&&(i=u({},i,u({},t,e.toString().split(","))),n.dependencies=l.extend(n.dependencies,i))})}},{key:"handleDependencies",value:function(){this.$fields.on("change",this.applyDependencies.bind(this)),this.applyDependencies()}},{key:"applyDependencies",value:function(){var i=this;l.each(this.dependencies,function(e,t){e=i.findFieldContainer(e),t=i.checkConditions(t);e.length&&(t?null!=e&&e.fadeIn():null!=e&&e.hide())})}},{key:"findField",value:function(e){e=this.$container.find("#".concat(e));return!!e.length&&e}},{key:"findFieldContainer",value:function(e){var t,e=this.findField(e);return!(null==e||!e.length||!(t=(t=(t=e.closest(".option-element")).length?t:e.closest(".yith-plugin-fw__panel__option")).length?t:e.closest(".form-row")).length)&&t}},{key:"checkConditions",value:function(e){var r=this,o=!0;return l.each(e,function(e,t){var i,n=r.findField(e);o&&null!=n&&n.length&&(i=n.first().is('input[type="radio"]')?n.filter(":checked").val().toString():null==n||null==(i=n.val())?void 0:i.toString(),o=Array.isArray(t)?t.includes(i):"function"==typeof t?t(i):0===t.indexOf(":")?n.is(t):0===t.indexOf("!:")?!n.is(t.toString().substring(1)):0===t.indexOf("!")?t.toString().substring(1)!==i:t.toString()===i,"undefined"!=typeof r.dependencies[e])&&(o=o&&r.checkConditions(r.dependencies[e]))}),o}}]),t}();function h(e){var t=(e=null!=(t=e)&&t.length?e:s).data("dependencies-handler");return t||(t=new c(e),e.data("dependencies-handler",t)),t}const f=h;var p=function(){function t(e){i(this,t),u(this,"$container",void 0),u(this,"ERROR_CLASS","woocommerce-invalid"),this.$container=e,null!=(e=this.$container)&&e.length&&this.initValidation()}return a(t,[{key:"initValidation",value:function v(){this.initForm(),this.initFields()}},{key:"initForm",value:function(){var i,e=this.$container.is("form")?this.$container:this.$container.find("form");e.length&&(i=this,e.on("submit yith_wcaf_validate_fields",function(e){var t=l(this);return!!i.validateForm(t)||(e.stopImmediatePropagation(),!1)}))}},{key:"initFields",value:function y(){var t,e=this.getFields(this.$container);e.length&&(t=this,e.on("keyup change",function(){var e=l(this);t.validateField(e)}))}},{key:"getFieldWrapper",value:function(e){return e.closest(".form-row, .yith-plugin-fw-panel-wc-row")}},{key:"getFields",value:function(e){return l("input, select, textarea",e).not('input[type="submit"]').not('input[type="hidden"]').not(".select2-search__field")}},{key:"getVisibleFields",value:function(e){var i=this;return this.getFields(e).filter(function(e,t){t=l(t);return i.getFieldWrapper(t).is(":visible")})}},{key:"isFieldValid",value:function(e){var t=this.getFieldWrapper(e),i=e.attr("type"),n=e.val();if(e.prop("required")||t.hasClass("required")||t.hasClass("validate-required")||t.hasClass("yith-plugin-fw--required")||["reg_username","reg_email","reg_password"].includes(e.get(0).id)){if("checkbox"===i&&!e.is(":checked"))throw"missing";if(!n||null==n||!n.length)throw"missing"}var r=t.data("pattern");if(r&&!new RegExp(r).test(n))throw"malformed";r=t.data("min_length");if(r&&n.length<r)throw"short";r=t.data("max_length");if(r&&n.length>r)throw"long";if("number"===i){t=parseFloat(e.attr("min")),r=parseFloat(e.attr("max")),i=parseFloat(n);if(t&&i<t||r&&r<i)throw"overflow"}return!0}},{key:"validateField",value:function(e){try{this.isFieldValid(e)}catch(t){return this.reportError(e,t),!1}return this.removeError(e),!0}},{key:"validateForm",value:function(e){var t,i,n=this.getVisibleFields(e);return!n.length||(t=this,i=!0,n.each(function(){var e=l(this);t.validateField(e)||(i=!1)}),!!i)||(this.scrollToFirstError(e),!1)}},{key:"getErrorMsg",value:function(e,t){var i=e.data("error");if(!i){var n=this.getFieldWrapper(e);if(!(i=n.data("error"))){var n=n.find("label");if(!(i=n.data("error"))){if(null==d||!d.errors)return!1;"missing"===t&&(i="checkbox"===e.attr("type")?null==(n=d.errors)?void 0:n.accept_check:null==(e=d.errors)?void 0:e.compile_field)||(i=null!=(n=d.errors)&&n[t]?null==(e=d.errors)?void 0:e[t]:null==(n=d.errors)?void 0:n.general_error)}}}return i}},{key:"reportError",value:function(e,t){var i=this.getFieldWrapper(e),e=this.getErrorMsg(e,t);i.addClass(this.ERROR_CLASS),e&&(i.find(".error-msg").remove(),t=l("<span/>",{"class":"error-msg",text:e}),i.append(t))}},{key:"removeError",value:function(e){var e=this.getFieldWrapper(e),t=e.find(".error-msg");e.removeClass(this.ERROR_CLASS),t.remove()}},{key:"scrollToFirstError",value:function(e){var t=e.find(".".concat(this.ERROR_CLASS)).first(),e=this.findScrollableParent(e),t=(e&&e.length||(e=l("html, body")),t.offset().top-e.offset().top),i=t;e.is("html, body")||(i=e.get(0).scrollTop+t),e.animate({scrollTop:i})}},{key:"findScrollableParent",value:function(e){var t,i=e.get(0);if(!i)return null;do{if(document===i)return null}while(!("visible"!==(t=window.getComputedStyle(i).overflowY)&&"hidden"!==t&&i.scrollHeight>i.clientHeight)&&(i=i.parentNode));return l(i)}}]),t}();function v(e){var t;null!=(t=e)&&t.length||(e=s),new p(e)}var y=function y(e){var t;null!=(t=e)&&t.length||(e=s),(t=l(":input[data-value]",e)).length&&t.each(function(){var e,t=l(this),i=t.data("value");if(t.is('input[type="checkbox"]')||t.is('input[type="radio"]'))"boolean"==typeof i?t.prop("checked",i):i?t.prop("checked",i===t.val()):t.prop("checked",!1);else if(t.is("select")&&Array.isArray(i))t.val(i);else if(t.is("select")&&"object"===r(i)){for(var n in i)null!=(e=t.find('[value="'.concat(n,'"]')))&&e.length||t.append(l("<option/>",{value:n,text:i[n]}));t.val(Object.keys(i))}else"boolean"==typeof i?t.val(i?1:0):i&&t.val(String(i));t.trigger("change")}),f(e),v(e),e.trigger("yith_fields_init")};const g=function(){function t(e){i(this,t),u(this,"$openers",null),u(this,"$target",null),u(this,"modal",null),e.length&&(this.$openers=e,this.init())}return a(t,[{key:"init",value:function(){var t=this;this.$openers.on("click",function(e){e.preventDefault(),t.$target=l(this),t.onOpen()})}},{key:"onOpen",value:function(){var e=null==this||null==(e=this.$target)?void 0:e.closest("[data-item]"),e=(null==e?void 0:e.data("item"))||{},e={title:null!==e&&e.id?d.edit_rule_title:d.add_rule_title,content:wp.template("yith-wcdp-add-deposit-rule-modal")(e),footer:!1,showClose:!0,width:350,classes:{wrap:"yith-wcdp-modal"}};this.modal=yith.ui.modal(e),y(this.modal.elements.content)}}]),t}();var m,b=function(){function e(){i(this,e),this.maybeInitDepositModal(),this.maybeInitSettings(),this.maybeInitVariationPanel()}return a(e,[{key:"maybeInitDepositModal",value:function(){var e=l("#yith_wcdp_panel_settings-rules");e.length&&this.initDepositModal(e)}},{key:"maybeInitSettings",value:function(){var e=l("#yith_wcdp_panel_settings-deposits").add("#yith_wcdp_panel_balances").add("#yith_wcdp_panel_customizations").add("#yith_wcdp_deposit_tab");e.length&&this.initSettings(e)}},{key:"maybeInitVariationPanel",value:function(){var e=this,i=l("#woocommerce-product-data");i.length&&(i.on("woocommerce_variations_loaded",function(){e.initSettings(i)}),i.on("woocommerce_variations_loaded woocommerce_variations_added woocommerce_variations_removed",function(){var e,t;(t=(t=(e=null!=(t=e=i)&&t.length?e:s).data("dependencies-handler"))||h(e)).reInit()}))}},{key:"initDepositModal",value:function(e){var t=l(".yith-wcdp-add-rule-button",e),e=l(".edit-deposit-rule",e);t.length&&new g(t.add(e))}},{key:"initSettings",value:function(e){y(e)}}]),e}(),_=(jQuery(function(){new b}),window);for(m in t)_[m]=t[m];t.__esModule&&Object.defineProperty(_,"__esModule",{value:!0})})();
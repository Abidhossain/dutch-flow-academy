(()=>{"use strict";var t={r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={},o=(t.r(e),jQuery),n=o(document),a=o("body"),i=function i(t){if("undefined"==typeof o.fn.block)return!1;try{return t.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),t}catch(e){return!1}},l=function l(t){if("undefined"==typeof o.fn.unblock)return!1;try{t.unblock()}catch(e){return!1}};null!=(t=yith_wcdp)&&t.labels;function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t){t=function(t,e){if("object"!=s(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);if("object"!=s(t=n.call(t,e||"default")))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==s(t)?t:t+""}function d(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,u(i.key),i)}}function c(t,e,n){e&&d(t.prototype,e),n&&d(t,n),Object.defineProperty(t,"prototype",{writable:!1})}function p(t,e,n){(e=u(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}var h,f=function(){function t(){r(this,t),p(this,"xhr",null),p(this,"$form",null),p(this,"$depositContainer",null),p(this,"$depositOptions",null),p(this,"$variationAddToCart",null),o("form.cart").length&&this.init()}return c(t,[{key:"getDepositPreferences",value:function(){return this.$depositOptions.length||this.initDom(),!!this.$depositOptions.length&&this.$depositOptions.data()}},{key:"getDepositValue",value:function(t){var e,n=this.getDepositPreferences();return n?"amount"===n.depositType&&n.depositAmount?Math.min(t,n.depositAmount):"rate"===n.depositType&&n.depositRate?(e=t*parseFloat(n.depositRate)/100,Math.min(t,e)):t:t}},{key:"formatPrice",value:function(t){return accounting.formatMoney(t,{symbol:yith_wcdp.currency_format.symbol,decimal:yith_wcdp.currency_format.decimal,thousand:yith_wcdp.currency_format.thousand,precision:yith_wcdp.currency_format.precision,format:yith_wcdp.currency_format.format})}},{key:"init",value:function(){this.initDom(),this.initVariations(),this.initActions()}},{key:"initDom",value:function(){var t;this.$form=o("form.cart"),this.$depositContainer=null==(t=this.$form)?void 0:t.find("#yith-wcdp-add-deposit-to-cart"),this.$depositOptions=null==(t=this.$depositContainer)?void 0:t.find(".yith-wcdp-single-add-to-cart-fields"),this.$variationAddToCart=null==(t=this.$form)?void 0:t.find(".woocommerce-variation-add-to-cart")}},{key:"initVariations",value:function(){var n=this;this.$form.length&&this.$form.hasClass("variations_form")&&this.$form.on("found_variation",function(t,e){return n.onFoundVariation(e)}).on("reset_data",function(){return n.removeTemplate()})}},{key:"initActions",value:function(){var i=this;n.on("yith_wcevti_price_refreshed yith_wapo_product_price_updated yith_wcp_price_updated",function(t,e){return i.updateTotals(e)}),n.on("ywdpd_price_html_updated",function(t,e,n){n&&i.updateTotals(n)}),n.on("yith_wcpb_ajax_update_price_request",function(t,e){e&&null!=e&&e.price&&i.updateTotals(e.price)})}},{key:"onFoundVariation",value:function(t){var e=this;this.doTemplateUpdate(t).then(function(){n.trigger("yith_wcdp_updated_deposit_form",e.$depositOptions)})}},{key:"doTemplateUpdate",value:function(e){var n=this;return yith_wcdp.ajax_variations?this.updateTemplateViaAjax(e):new Promise(function(t){"undefined"!=typeof e.add_deposit_to_cart?n.updateTemplateViaVariation(e):deposit_options.length&&n.updateTotals(e.display_price),t()})}},{key:"updateTemplateViaAjax",value:function(t){var e=this;return this.xhr=o.ajax({beforeSend:function(){null!=e.xhr&&e.xhr.abort(),e.hideTemplate(),i(e.$form)},complete:function(){return l(e.$form)},data:{variation_id:null==t?void 0:t.variation_id,variation_attr:this.$form.find(".variations select").serializeArray().reduce(function(t,e){return t[e.name]=e.value,t},{}),action:null==(t=yith_wcdp)||null==(t=t.actions)||null==(t=t.get_add_deposit)?void 0:t.name,_wpnonce:null==(t=yith_wcdp)||null==(t=t.actions)||null==(t=t.get_add_deposit)?void 0:t.nonce},dataType:"html",method:"POST",success:function(t){return e.updateTemplate(t)},url:yith_wcdp.ajax_url}),this.xhr}},{key:"updateTemplateViaVariation",value:function(t){this.updateTemplate(t.add_deposit_to_cart)}},{key:"hideTemplate",value:function(){this.$depositContainer.length&&this.$depositContainer.hide()}},{key:"updateTemplate",value:function(t){this.removeTemplate(),this.$variationAddToCart.before(t),this.initDom()}},{key:"removeTemplate",value:function(){this.$depositContainer.length&&this.$depositContainer.remove()}},{key:"updateTotals",value:function(t){var e=this.formatPrice(t),t=this.getDepositValue(t),t=this.formatPrice(t);this.$depositOptions.find(".full-price").html(e),this.$depositOptions.find(".deposit-price").html(t)}}]),t}(),m=function(){function n(t,e){r(this,n),p(this,"opener",null),p(this,"$target",null),p(this,"$modal",null),p(this,"$content",null),t&&(this.opener=t,this.args=o.extend({title:!1,shouldOpen:!1,template:!1,onOpen:!1,onClose:!1},e||{}),this.init())}return c(n,[{key:"init",value:function(){var e=this;o(document).off("click",this.opener).on("click",this.opener,function(t){e.$target=o(t.target),e.shouldOpen()&&(t.preventDefault(),e.onOpen())})}},{key:"shouldOpen",value:function(){var t;return"function"!=typeof(null==(t=this.args)?void 0:t.shouldOpen)||this.args.shouldOpen.call(this)}},{key:"onOpen",value:function(){var t,e=(null==(e=this.args)?void 0:e.template)||"",n=null;if("function"==typeof e&&(e=e.call(this)),null==(t=this.$content)||!t.length){if(this.$target.data("modal"))n=o("#".concat(this.$target.data("modal"))).detach();else{if(!e)return;"string"==typeof e?n=o(e).detach():"function"==typeof e?n=e().detach():null!=(t=e)&&t.lenght&&(n=e.detach())}this.$content=n}this.maybeOpenModal(this.$content)}},{key:"onClose",value:function(){this.maybeCloseModal()}},{key:"maybeBuildModal",value:function(){var t,e,n,i=this;return null!=(t=this.$modal)&&t.length||(t=o("<div/>",{"class":"yith-wcdp-modal"}),e=o("<div/>",{"class":"content pretty-scrollbar"}),n=o("<a/>",{"class":"close-button main-close-button",html:"&times;",role:"button",href:"#"}),(this.$modal=t).append(e).append(n),null!=(e=this.args)&&e.title&&(n=o("<div/>",{"class":"title",html:"<h3>".concat(this.args.title,"</h3>")}),t.prepend(n)),t.on("click",".close-button",function(t){t.preventDefault(),i.onClose()}),a.append(t)),this.$modal}},{key:"maybeDestroyModal",value:function(){var t;null!=(t=this.$modal)&&t.length&&this.$modal.remove()}},{key:"maybeOpenModal",value:function(t){var e,n=this;null!=(e=this.$modal)&&e.length||this.maybeBuildModal(),this.$modal.hasClass("open")||(this.$modal.find(".content").append(t).end().fadeIn(function(){var t;n.$modal.addClass("open"),"function"==typeof(null==(t=n.args)?void 0:t.onOpen)&&null!=(t=n.args)&&t.onOpen.call(n)}),a.addClass("yith-wcdp-open-modal"))}},{key:"maybeCloseModal",value:function(){var t,e=this;null!=(t=this.$modal)&&t.length||this.maybeBuildModal(),this.$modal.hasClass("open")&&this.$modal.fadeOut(function(){var t;e.$modal.removeClass("open"),a.removeClass("yith-wcdp-open-modal"),"function"==typeof(null==(t=e.args)?void 0:t.onClose)&&null!=(t=e.args)&&t.onClose.call(e)})}}]),n}(),y=function(){function e(t){r(this,e),p(this,"$container",null),p(this,"$buttons",null),p(this,"$openers",null),t.length&&(this.$container=t,this.init())}return c(e,[{key:"init",value:function(){this.$buttons=this.$container.find(".button-with-submenu"),this.$openers=this.$buttons.find("a.submenu-opener"),this.initOpeners(),this.initBackdrop()}},{key:"initOpeners",value:function(){var n=this;this.$openers.not(".initialized").each(function(){var e=o(this);e.on("click",function(t){t.stopPropagation(),n.toggleMenu.call(n,e)}).addClass("initialized")})}},{key:"initBackdrop",value:function(){o(document).on("click",this.closeAll.bind(this))}},{key:"toggleMenu",value:function(t){t=t.parent(".button-with-submenu");t.hasClass("opened")?this.close(t):(this.closeAll(),this.open(t))}},{key:"open",value:function(t){t.addClass("opened")}},{key:"close",value:function(t){t.removeClass("opened")}},{key:"closeAll",value:function(){this.$buttons.removeClass("opened")}}]),e}(),v=(jQuery(function(){new f;var t=o("#yith_wcdp_deposits_details"),e=(t.length&&new y(t),function e(){new m(".deposit-expiration-modal-opener",{title:yith_wcdp.labels.deposit_expiration_modal_title})});n.on("updated_checkout",e),e()}),window);for(h in e)v[h]=e[h];e.__esModule&&Object.defineProperty(v,"__esModule",{value:!0})})();